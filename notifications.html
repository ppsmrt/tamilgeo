<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TamilGeo - Notifications</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/feather-icons"></script>
  <style>
    .bottom-nav {
      backdrop-filter: blur(15px);
      background: linear-gradient(90deg, #32a852, #28b66f);
      border-radius: 1.5rem 1.5rem 0 0;
      position: fixed;
      bottom: 0;
      width: 100%;
      padding: 1rem 2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      color: white;
    }
    .dial {
      width: 180px;
      height: 180px;
      border-radius: 50%;
      background: linear-gradient(145deg, #e0f2e9, #b0e0c6);
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 8px 8px 15px #a3cbb3, -8px -8px 15px #ffffff;
      margin: auto;
      position: relative;
    }
    .dial-inner {
      width: 140px;
      height: 140px;
      border-radius: 50%;
      background: #f0fff4;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      box-shadow: inset 6px 6px 10px #c8e6d2, inset -6px -6px 10px #ffffff;
    }
body { font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", Inter, sans-serif; }
    .card { border-radius: 1.25rem; }
    .tab-active { background: linear-gradient(to right, #22c55e, #16a34a); color: white; }
.install-btn {
  position: fixed;
  bottom: 20px;
  right: 20px;
  width: 60px;
  height: 60px;
  border: none;
  border-radius: 50%;
  background: linear-gradient(135deg, #00c853, #64dd17);
  color: white;
  font-size: 28px;
  display: flex;
  align-items: center;
  justify-content: center;
  box-shadow: 0 4px 10px rgba(0,0,0,0.3);
  cursor: pointer;
  z-index: 9999;
  transition: transform 0.2s ease-in-out;
}
.install-btn:hover {
  transform: scale(1.1);
}
.hidden {
  display: none;
}
  </style>
<!-- ✅ Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- ✅ FontAwesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" />
</head>

</head>
  <body class="bg-gray-100 min-h-screen flex flex-col">

     <!-- ✅ Header -->
  <script type="module" src="assets/js/header.js"></script>
    
    
  <!-- ✅ Notifications List -->

<ul id="notifications-list" class="space-y-3"></ul>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
import { getDatabase, ref, onValue, set, get } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

const firebaseConfig = { /* your config */ };
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getDatabase(app);

const notifList = document.getElementById("notifications-list");

// category → icon
const categoryIcons = {
  general: "fa fa-bell text-blue-500",
  political: "fa fa-university text-yellow-600",
  nature: "fa fa-leaf text-green-600",
  technology: "fa fa-laptop-code text-gray-700",
  health: "fa fa-heart text-red-500",
  entertainment: "fa fa-film text-purple-600",
  shopping: "fa fa-shopping-cart text-pink-500"
};

onAuthStateChanged(auth, async user => {
  if (!user) {
    alert("Please login to see notifications.");
    window.location.href = "login.html";
    return;
  }

  onValue(ref(db, "notifications"), async snapshot => {
    notifList.innerHTML = "";
    const allNotifs = snapshot.val() || {};

    // get dismissed notifications for this user
    const dismissedSnap = await get(ref(db, `userNotifications/${user.uid}`));
    const dismissed = dismissedSnap.val() || {};

    Object.values(allNotifs)
      .sort((a, b) => b.timestamp - a.timestamp)
      .forEach(notif => {
        if (!dismissed[notif.id]) {
          const li = document.createElement("li");
          li.className = "p-4 border rounded-lg shadow flex items-start space-x-3 bg-white";

          li.innerHTML = `
            <i class="${categoryIcons[notif.category] || categoryIcons.general} text-2xl"></i>
            <div class="flex-1">
              <h3 class="font-bold text-lg">${notif.title}</h3>
              <p class="text-gray-600">${notif.description}</p>
              <p class="text-sm text-gray-500 mt-1">${notif.message}</p>
              ${notif.imageUrl ? `<img src="${notif.imageUrl}" alt="Notification Image" class="mt-2 rounded-lg max-h-40">` : ""}
              ${notif.linkUrl ? `<a href="${notif.linkUrl}" target="_blank" class="text-blue-600 hover:underline mt-2 block">Read More</a>` : ""}
            </div>
            <button class="dismiss bg-red-500 text-white px-3 py-1 rounded" data-id="${notif.id}">
              Dismiss
            </button>
          `;

          notifList.appendChild(li);
        }
      });

    // handle dismiss
    document.querySelectorAll(".dismiss").forEach(btn => {
      btn.addEventListener("click", async e => {
        const notifId = e.target.dataset.id;
        await set(ref(db, `userNotifications/${user.uid}/${notifId}`), true);
      });
    });
  });
});
</script>
 
<!-- ✅ Bottom Navigation -->

<script type="module">
  import { initFooter } from './assets/js/footer.js';
  initFooter();
</script>       