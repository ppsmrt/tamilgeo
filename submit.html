<!DOCTYPE html>
<html lang="ta">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Submit Post - TamilGeo</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"/>
  <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet"/>

  <style>
    body { font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", Inter, sans-serif; }
    .card { border-radius: 1.25rem; }
    .btn-primary {
      background: linear-gradient(to right, #22c55e, #16a34a);
      color: white;
      font-weight: 600;
      padding: 0.75rem 1.5rem;
      border-radius: 0.75rem;
      transition: all 0.2s ease-in-out;
    }
    .btn-primary:hover {
      background: linear-gradient(to right, #16a34a, #15803d);
      transform: scale(1.02);
    }
    #editor-container {
      background: white;
      border-radius: 1rem;
      min-height: 200px;
    }
  </style>
</head>
<body class="bg-gray-100 min-h-screen flex flex-col">

  <!-- ‚úÖ Shared Header -->
  <div id="shared-header"></div>

  <main class="max-w-3xl mx-auto p-6 flex-grow">
    <h1 class="text-3xl font-bold mb-6 text-gray-800">Submit a Post</h1>

    <!-- üìú Rules Box -->
    <div class="bg-yellow-50 border border-yellow-300 p-5 mb-6 rounded-xl shadow-md">
      <h2 class="text-lg font-semibold mb-2 text-yellow-800">üìå Rules to be Followed</h2>
      <ul class="list-disc pl-6 space-y-1 text-gray-700 text-sm">
        <li>Posts must be original and relevant to the community.</li>
        <li>No offensive, abusive, or misleading content.</li>
        <li>Posts may be edited or deleted by admins during review.</li>
        <li>Ensure content is factually accurate before submitting.</li>
        <li>Respect copyright laws when using text or images.</li>
      </ul>
    </div>

    <!-- ‚úÖ Submit Post Form -->
    <form id="postForm" class="bg-white p-6 rounded-2xl shadow-lg space-y-4">

      <input type="text" id="title" placeholder="Post Title"
        class="w-full p-3 border rounded-xl focus:ring-2 focus:ring-green-400 focus:outline-none" required>

      <select id="category"
        class="w-full p-3 border rounded-xl focus:ring-2 focus:ring-green-400 focus:outline-none" required>
        <option value="">Select Category</option>
        <option value="Political">Political</option>
        <option value="Nature">Nature</option>
        <option value="Technology">Technology</option>
        <option value="Entertainment">Entertainment</option>
        <option value="Shopping">Shopping</option>
      </select>

      <input type="text" id="tags" placeholder="Tags (comma separated)"
        class="w-full p-3 border rounded-xl focus:ring-2 focus:ring-green-400 focus:outline-none">

      <textarea id="excerpt" placeholder="Short Description / Excerpt"
        class="w-full p-3 border rounded-xl focus:ring-2 focus:ring-green-400 focus:outline-none" rows="3" required></textarea>

      <input type="text" id="author"
        class="w-full p-3 border rounded-xl bg-gray-100 text-gray-600" readonly>

      <!-- ‚úÖ Quill Editor -->
      <div id="editor-container" class="mb-4"></div>

      <input type="url" id="image" placeholder="Image URL (optional)"
        class="w-full p-3 border rounded-xl focus:ring-2 focus:ring-green-400 focus:outline-none">

      <label class="flex items-center text-sm text-gray-700">
        <input type="checkbox" id="acceptRules" class="mr-2 rounded" required>
        I have read and agree to the above rules.
      </label>

      <button type="submit" class="btn-primary w-full shadow-lg">üöÄ Submit Post</button>
    </form>
  </main>

  <!-- ‚úÖ Firebase + Script -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
    import { getDatabase, ref, push, set } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDt86oFFa-h04TsfMWSFGe3UHw26WYoR-U",
      authDomain: "tamilgeoapp.firebaseapp.com",
      databaseURL: "https://tamilgeoapp-default-rtdb.firebaseio.com",
      projectId: "tamilgeoapp",
      storageBucket: "tamilgeoapp.appspot.com",
      messagingSenderId: "1092623024431",
      appId: "1:1092623024431:web:ea455dd68a9fcf480be1da"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getDatabase(app);

    const postForm = document.getElementById("postForm");
    const authorInput = document.getElementById("author");

    // ‚úÖ Initialize Quill
    var quill = new Quill('#editor-container', {
      theme: 'snow',
      modules: {
        toolbar: [
          [{ 'header': '1'}, { 'header': '2'}, { 'font': [] }],
          [{ 'list': 'ordered'}, { 'list': 'bullet' }],
          ['bold', 'italic', 'underline', 'strike'],
          [{ 'color': [] }, { 'background': [] }],
          [{ 'align': [] }],
          ['link', 'blockquote', 'code-block']
        ]
      }
    });

    // ‚úÖ Allow only logged-in users (but no login form here)
    onAuthStateChanged(auth, (user) => {
      if (!user) {
        window.location.href = "/login.html";
        return;
      }
      authorInput.value = user.displayName || user.email;

      postForm.addEventListener("submit", (e) => {
        e.preventDefault();

        const title = document.getElementById("title").value.trim();
        const category = document.getElementById("category").value.trim();
        const tags = document.getElementById("tags").value.trim();
        const excerpt = document.getElementById("excerpt").value.trim();
        const content = quill.root.innerHTML.trim();
        const image = document.getElementById("image").value.trim();
        const acceptRules = document.getElementById("acceptRules").checked;

        if (!title || !category || !excerpt || !content) {
          alert("‚ö† Please fill in all required fields.");
          return;
        }
        if (!acceptRules) {
          alert("‚ö† You must agree to the rules before submitting.");
          return;
        }

        const postId = push(ref(db, "pendingPosts")).key;
        const postData = {
          title,
          category,
          tags: tags ? tags.split(",").map(t => t.trim()) : [],
          excerpt,
          content,
          image: image || null,
          author: user.displayName || user.email,
          date: Date.now(),
          status: "pending"
        };

        set(ref(db, "pendingPosts/" + postId), postData)
          .then(() => {
            alert("‚úÖ Post submitted for approval!");
            postForm.reset();
            quill.setContents([]);
            authorInput.value = user.displayName || user.email;
          })
          .catch(err => {
            console.error(err);
            alert("‚ùå Error submitting post.");
          });
      });
    });
  </script>

  <!-- ‚úÖ Footer -->
  <script type="module">
  import { initFooter } from './assets/js/footer.js';
  initFooter();
</script>       

  <!-- ‚úÖ Quill -->
  <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
</body>
</html>